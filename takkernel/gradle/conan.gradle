import java.security.MessageDigest

project.ext.getHash = { s ->
    try {
        def digest = MessageDigest.getInstance("SHA-256")
        def hash = digest.digest(s.getBytes("UTF-8"))
        return Base64.encoder.encodeToString(hash)
    } catch(Exception ex) {
        def toThrow = new GradleException()
        toThrow.initCause(ex)
        throw toThrow
    }
}

// configure Conan
task configureConan {
    group = 'Build'
    description = 'Configures the Conan repository and credentials to be used when pulling down Conan-based dependencies.'

    doLast {
        return
   }
}

afterEvaluate {
    // native build depends on conan configuration
    def preExternalNativeBuildTask = tasks.findByName('preExternalNativeBuild')
    if(preExternalNativeBuildTask) {
        preExternalNativeBuildTask.dependsOn configureConan
    }
}
